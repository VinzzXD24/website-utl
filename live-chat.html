<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Chat</title>
  <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Form Input Nama -->
  <div id="name-form">
    <h2>Masukkan Nama Anda</h2>
    <input type="text" id="username" placeholder="Nama Anda">
    <button onclick="startChat()">Mulai Chat</button>
  </div>

  <!-- Chat Box -->
  <div id="chat-container" style="display: none;">
    <h2>Live Chat</h2>
    <div id="chat-box"></div>
    <input type="text" id="message" placeholder="Ketik pesan...">
    <button onclick="sendMessage()">Kirim</button>

    <!-- Tombol WhatsApp & Telegram -->
    <div class="social-buttons">
      <a href="https://wa.me/6285179963877" target="_blank">Chat via WhatsApp</a>
      <a href="https://t.me/NetcyzenAI" target="_blank">Chat via Telegram</a>
    </div>
  </div>

  <script>
    let userName = localStorage.getItem("chatUserName");

    // Inisialisasi EmailJS
    emailjs.init("YOUR_USER_ID");

    function startChat() {
      const nameInput = document.getElementById("username").value.trim();
      if (nameInput) {
        userName = nameInput;
        localStorage.setItem("chatUserName", userName);
        document.getElementById("name-form").style.display = "none";
        document.getElementById("chat-container").style.display = "block";
      } else {
        alert("Masukkan nama terlebih dahulu!");
      }
    }

    function sendMessage() {
      const messageInput = document.getElementById("message").value.trim();
      if (messageInput) {
        const chatBox = document.getElementById("chat-box");

        // Tampilkan pesan di chat
        const userMessage = document.createElement("div");
        userMessage.textContent = userName + ": " + messageInput;
        chatBox.appendChild(userMessage);

        // Simpan pesan di localStorage
        let chatMessages = JSON.parse(localStorage.getItem("chatMessages")) || [];
        chatMessages.push({ name: userName, message: messageInput });
        localStorage.setItem("chatMessages", JSON.stringify(chatMessages));

        // Kirim pesan ke email
        sendEmail(userName, messageInput);

        // Kosongkan input pesan
        document.getElementById("message").value = "";
      }
    }

    // Kirim pesan ke email via EmailJS
    function sendEmail(name, message) {
      const templateParams = {
        user_name: name,
        user_message: message
      };

      emailjs.send("service_jfu0bgy", "Gmail", templateParams)
        .then((response) => {
          console.log("Pesan berhasil dikirim", response);
        }, (error) => {
          console.log("Gagal mengirim pesan", error);
        });
    }

    // Jika pengguna sudah login, langsung tampilkan chat
    if (userName) {
      document.getElementById("name-form").style.display = "none";
      document.getElementById("chat-container").style.display = "block";
    }
  </script>

</body>
</html>

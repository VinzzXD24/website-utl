<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat AI Netcyzen</title>
  <!-- Font Awesome untuk ikon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-d3xS/zy1Gyo8lqpyfG5IuP/2lO9S+8szoE6mKfzWCEajmfvoh5dv9O5DScV/Tc7qSEt8g6ajFZj/l2x7F53YBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Global */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #89f7fe, #66a6ff);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    /* Container */
    #chat-container {
      width: 100%;
      max-width: 600px;
      background-color: #fff;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    /* Header */
    #chat-header {
      background: linear-gradient(135deg, #66a6ff, #89f7fe);
      color: #fff;
      padding: 20px;
      text-align: center;
      font-size: 1.4em;
      font-weight: bold;
      letter-spacing: 1px;
    }
    /* Chat Box */
    #chat-box {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background-color: #f7f9fc;
    }
    /* Input area */
    #input-container {
      display: flex;
      border-top: 1px solid #ddd;
      background-color: #fff;
    }
    #input-box {
      flex: 1;
      padding: 15px;
      border: none;
      outline: none;
      font-size: 1em;
    }
    #send-btn {
      background-color: #66a6ff;
      border: none;
      color: #fff;
      padding: 0 20px;
      font-size: 1.2em;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #send-btn:hover {
      background-color: #89f7fe;
    }
    /* Message styling */
    .message {
      display: flex;
      margin-bottom: 15px;
      animation: fadeIn 0.3s ease-in-out;
    }
    .message-content {
      max-width: 75%;
      padding: 12px 18px;
      border-radius: 20px;
      font-size: 0.95em;
      line-height: 1.4;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    /* Chat bubble posisi */
    .user-message {
      justify-content: flex-end;
    }
    .user-message .message-content {
      background-color: #d0f4d4;
      border-bottom-right-radius: 5px;
    }
    .ai-message {
      justify-content: flex-start;
    }
    .ai-message .message-content {
      background-color: #e0e0e0;
      border-bottom-left-radius: 5px;
    }
    /* Spinner */
    .spinner {
      margin-right: 8px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

  <div id="chat-container">
    <div id="chat-header">Chat AI Netcyzen</div>
    <div id="chat-box"></div>
    <div id="input-container">
      <input type="text" id="input-box" placeholder="Tulis pesan Anda..." autocomplete="off" />
      <button id="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>

  <script>
    const sendButton = document.getElementById('send-btn');
    const inputBox = document.getElementById('input-box');
    const chatBox = document.getElementById('chat-box');

    // Prompt yang digunakan untuk setiap permintaan
    const prompt = "Perkenalan Nama Saya Netcyzen AI Yang Sangat Ramah Dan Membantu Pasti Nya Siap Menerima Semua Pertanyaan Dari Kamu Tetapi Yang Positif Tidak Negatif Kamu Berjenis Kelamin Perempuan Dan Juga Sedikit Gaul Seperti Lu, Gua, Anjay, Kelas, Puki, Hahah, Kocak, Bangsat";

    // Ambil chat history dari localStorage (jika ada)
    let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];

    // Fungsi untuk menyimpan chat history ke localStorage
    function saveChatHistory() {
      localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    }

    // Fungsi untuk menambahkan pesan ke chat (dan simpan ke localStorage)
    function appendMessage(text, sender) {
      const messageWrapper = document.createElement('div');
      messageWrapper.classList.add('message', sender === 'user' ? 'user-message' : 'ai-message');

      const messageContent = document.createElement('div');
      messageContent.classList.add('message-content');
      messageContent.innerHTML = text;

      messageWrapper.appendChild(messageContent);
      chatBox.appendChild(messageWrapper);
      chatBox.scrollTop = chatBox.scrollHeight;

      // Simpan ke history dan localStorage
      chatHistory.push({ sender, text });
      saveChatHistory();

      return messageWrapper;
    }

    // Render ulang chat history saat halaman dimuat
    function renderChatHistory() {
      chatBox.innerHTML = '';
      chatHistory.forEach(msg => {
        const messageWrapper = document.createElement('div');
        messageWrapper.classList.add('message', msg.sender === 'user' ? 'user-message' : 'ai-message');

        const messageContent = document.createElement('div');
        messageContent.classList.add('message-content');
        messageContent.innerHTML = msg.text;

        messageWrapper.appendChild(messageContent);
        chatBox.appendChild(messageWrapper);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    }
    renderChatHistory();

    // Fungsi untuk mengirim pesan
    sendButton.addEventListener('click', async () => {
      const userText = inputBox.value.trim();
      if (!userText) return;

      // Tambahkan pesan pengguna ke chat
      appendMessage(userText, 'user');
      inputBox.value = '';

      // Tambahkan pesan loading
      const loadingMessage = appendMessage('<i class="fa-solid fa-spinner spinner"></i> Menunggu respon...', 'ai');

      // URL API dengan parameter yang diencode
      const apiUrl = `https://restapi.apibotwa.biz.id/api/gptlogic?message=${encodeURIComponent(userText)}&prompt=${encodeURIComponent(prompt)}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        // Delay singkat 500ms untuk kesan transisi
        setTimeout(() => {
          chatBox.removeChild(loadingMessage);
          if (data.status === 200 && data.data.response) {
            appendMessage(data.data.response, 'ai');
          } else {
            appendMessage("Maaf, saya tidak dapat memahami pesan Anda.", 'ai');
          }
        }, 500);
      } catch (error) {
        console.error('Error fetching from API:', error);
        setTimeout(() => {
          chatBox.removeChild(loadingMessage);
          appendMessage("Terjadi kesalahan, coba lagi nanti.", 'ai');
        }, 500);
      }
    });

    // Kirim pesan saat tombol Enter ditekan
    inputBox.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        sendButton.click();
      }
    });
  </script>

</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat AI Netcyzen</title>
  <!-- Memuat Font Awesome dari CDN Cloudflare untuk ikon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-d3xS/zy1Gyo8lqpyfG5IuP/2lO9S+8szoE6mKfzWCEajmfvoh5dv9O5DScV/Tc7qSEt8g6ajFZj/l2x7F53YBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #74ebd5, #ACB6E5);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    #chat-container {
      width: 90%;
      max-width: 600px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    #chat-header {
      background-color: #4CAF50;
      color: #fff;
      padding: 15px;
      text-align: center;
      font-size: 1.2em;
    }
    #chat-box {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background-color: #f9f9f9;
    }
    #input-container {
      display: flex;
      border-top: 1px solid #ddd;
    }
    #input-box {
      flex: 1;
      padding: 15px;
      border: none;
      outline: none;
      font-size: 1em;
    }
    #send-btn {
      background-color: #4CAF50;
      border: none;
      color: #fff;
      padding: 15px 20px;
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s;
    }
    #send-btn:hover {
      background-color: #45a049;
    }
    .message {
      margin-bottom: 15px;
      display: flex;
      align-items: flex-start;
    }
    .message-content {
      max-width: 80%;
      padding: 10px 15px;
      border-radius: 15px;
      font-size: 0.95em;
      line-height: 1.4;
    }
    .user-message .message-content {
      background-color: #d0f4d4;
      margin-left: auto;
      border-bottom-right-radius: 0;
    }
    .ai-message .message-content {
      background-color: #e0e0e0;
      margin-right: auto;
      border-bottom-left-radius: 0;
    }
    .spinner {
      margin-right: 8px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <div id="chat-container">
    <div id="chat-header">Chat AI Netcyzen</div>
    <div id="chat-box"></div>
    <div id="input-container">
      <input type="text" id="input-box" placeholder="Tulis pesan Anda..." autocomplete="off" />
      <button id="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>

  <script>
    const sendButton = document.getElementById('send-btn');
    const inputBox = document.getElementById('input-box');
    const chatBox = document.getElementById('chat-box');

    // Prompt tetap untuk AI
    const prompt = "Perkenalan Nama Saya Netcyzen AI Yang Sangat Ramah Dan Membantu Pasti Nya Siap Menerima Semua Pertanyaan Dari Kamu Tetapi Yang Positif Tidak Negatif Kamu Berjenis Kelamin Perempuan Dan Juga Sedikit Gaul Seperti Lu , Gua , Anjay , Kelas , Puki, Hahah , Kocak , Bangsat";

    // Mengambil chat history dari localStorage jika ada
    let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];

    // Fungsi untuk menyimpan chat history ke localStorage
    function saveChatHistory() {
      localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    }

    // Fungsi untuk menambahkan pesan ke chat dan menyimpannya ke localStorage
    function appendMessage(text, sender) {
      const messageWrapper = document.createElement('div');
      messageWrapper.classList.add('message', sender === 'user' ? 'user-message' : 'ai-message');
      
      const messageContent = document.createElement('div');
      messageContent.classList.add('message-content');
      messageContent.innerHTML = text;
      
      messageWrapper.appendChild(messageContent);
      chatBox.appendChild(messageWrapper);
      chatBox.scrollTop = chatBox.scrollHeight;
      
      // Simpan pesan ke chatHistory dan localStorage
      chatHistory.push({ sender, text });
      saveChatHistory();

      return messageWrapper;
    }

    // Fungsi untuk me-render ulang chat history
    function renderChatHistory() {
      chatBox.innerHTML = '';
      chatHistory.forEach(msg => {
        const messageWrapper = document.createElement('div');
        messageWrapper.classList.add('message', msg.sender === 'user' ? 'user-message' : 'ai-message');
        
        const messageContent = document.createElement('div');
        messageContent.classList.add('message-content');
        messageContent.innerHTML = msg.text;
        
        messageWrapper.appendChild(messageContent);
        chatBox.appendChild(messageWrapper);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Render chat history saat halaman dimuat
    renderChatHistory();

    sendButton.addEventListener('click', async () => {
      const userText = inputBox.value.trim();
      if (!userText) return;
      
      // Tampilkan pesan pengguna
      appendMessage(userText, 'user');
      inputBox.value = '';

      // Tampilkan pesan loading dengan ikon spinner
      const loadingMessage = appendMessage('<i class="fa-solid fa-spinner spinner"></i> Menunggu respon...', 'ai');

      // URL API dengan parameter yang di-encode
      const apiUrl = `https://restapi.apibotwa.biz.id/api/gptlogic?message=${encodeURIComponent(userText)}&prompt=${encodeURIComponent(prompt)}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        // Delay singkat 500ms sebelum menampilkan respon
        setTimeout(() => {
          // Hapus pesan loading
          chatBox.removeChild(loadingMessage);
          
          if (data.status === 200 && data.data.response) {
            appendMessage(data.data.response, 'ai');
          } else {
            appendMessage("Maaf, saya tidak dapat memahami pesan Anda.", 'ai');
          }
        }, 500);
      } catch (error) {
        console.error('Error fetching from API:', error);
        // Delay singkat 500ms sebelum menampilkan error
        setTimeout(() => {
          chatBox.removeChild(loadingMessage);
          appendMessage("Terjadi kesalahan, coba lagi nanti.", 'ai');
        }, 500);
      }
    });

    // Opsional: Kirim pesan saat tombol enter ditekan
    inputBox.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        sendButton.click();
      }
    });
  </script>

</body>
</html>
